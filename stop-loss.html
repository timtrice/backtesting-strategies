<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Backtesting Strategies with R</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="Backtesting strategies with R">
  <meta name="generator" content="bookdown 0.0.62 and GitBook 2.6.7">

  <meta property="og:title" content="Backtesting Strategies with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Backtesting strategies with R" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Backtesting Strategies with R" />
  
  <meta name="twitter:description" content="Backtesting strategies with R" />
  

<meta name="author" content="Tim Trice">

<meta name="date" content="2016-05-02">

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="parameter-optimization.html">
<link rel="next" href="stop-loss-optimization.html">

<script src="assets/jquery-2.2.3/jquery.min.js"></script>
<link href="assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="assets/htmlwidgets-0.6/htmlwidgets.js"></script>
<script src="assets/datatables-binding-0.1/datatables.js"></script>
<script src="assets/datatables-1.10.7/jquery.dataTables.min.js"></script>
<link href="assets/datatables-default-1.10.7/dataTables.extra.css" rel="stylesheet" />
<link href="assets/datatables-default-1.10.7/jquery.dataTables.min.css" rel="stylesheet" />
<link href="assets/datatables-scroller-1.10.7/dataTables.scroller.min.css" rel="stylesheet" />
<script src="assets/datatables-scroller-1.10.7/dataTables.scroller.min.js"></script>
<link href="assets/datatables-fixedColumns-1.10.7/dataTables.fixedColumns.min.css" rel="stylesheet" />
<script src="assets/datatables-fixedColumns-1.10.7/dataTables.fixedColumns.min.js"></script>
<link href="assets/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="assets/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="assets/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="assets/selectize-0.12.0/selectize.min.js"></script>
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-1507390-25', 'auto');
ga('send', 'pageview');

</script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="custom_styles.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#r-resources"><i class="fa fa-check"></i><b>1.1</b> R Resources</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#libraries"><i class="fa fa-check"></i><b>1.2</b> Libraries</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#sessioninfo"><i class="fa fa-check"></i><b>1.3</b> SessionInfo</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="terminology.html"><a href="terminology.html"><i class="fa fa-check"></i><b>2</b> Terminology</a></li>
<li class="chapter" data-level="3" data-path="using-quantstrat.html"><a href="using-quantstrat.html"><i class="fa fa-check"></i><b>3</b> Using Quantsrat</a><ul>
<li class="chapter" data-level="3.1" data-path="using-quantstrat.html"><a href="using-quantstrat.html#settings-and-variables"><i class="fa fa-check"></i><b>3.1</b> Settings and Variables</a></li>
<li class="chapter" data-level="3.2" data-path="using-quantstrat.html"><a href="using-quantstrat.html#symbols"><i class="fa fa-check"></i><b>3.2</b> Symbols</a></li>
<li class="chapter" data-level="3.3" data-path="using-quantstrat.html"><a href="using-quantstrat.html#checkBlotterUpdate"><i class="fa fa-check"></i><b>3.3</b> checkBlotterUpdate()</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="get-symbols.html"><a href="get-symbols.html"><i class="fa fa-check"></i><b>4</b> Get Symbols</a><ul>
<li class="chapter" data-level="4.1" data-path="get-symbols.html"><a href="get-symbols.html#yahoo"><i class="fa fa-check"></i><b>4.1</b> Yahoo!</a></li>
<li class="chapter" data-level="4.2" data-path="get-symbols.html"><a href="get-symbols.html#google"><i class="fa fa-check"></i><b>4.2</b> Google</a></li>
<li class="chapter" data-level="4.3" data-path="get-symbols.html"><a href="get-symbols.html#mysql"><i class="fa fa-check"></i><b>4.3</b> MySQL</a></li>
<li class="chapter" data-level="4.4" data-path="get-symbols.html"><a href="get-symbols.html#fred"><i class="fa fa-check"></i><b>4.4</b> FRED</a></li>
<li class="chapter" data-level="4.5" data-path="get-symbols.html"><a href="get-symbols.html#oanda"><i class="fa fa-check"></i><b>4.5</b> OANDA</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="basic-strategy.html"><a href="basic-strategy.html"><i class="fa fa-check"></i><b>5</b> Basic Strategy</a><ul>
<li class="chapter" data-level="5.1" data-path="basic-strategy.html"><a href="basic-strategy.html#strategy-setup"><i class="fa fa-check"></i><b>5.1</b> Strategy Setup</a></li>
<li class="chapter" data-level="5.2" data-path="basic-strategy.html"><a href="basic-strategy.html#add-indicators"><i class="fa fa-check"></i><b>5.2</b> Add Indicators</a></li>
<li class="chapter" data-level="5.3" data-path="basic-strategy.html"><a href="basic-strategy.html#add-signals"><i class="fa fa-check"></i><b>5.3</b> Add Signals</a></li>
<li class="chapter" data-level="5.4" data-path="basic-strategy.html"><a href="basic-strategy.html#add-rules"><i class="fa fa-check"></i><b>5.4</b> Add Rules</a></li>
<li class="chapter" data-level="5.5" data-path="basic-strategy.html"><a href="basic-strategy.html#apply-strategy"><i class="fa fa-check"></i><b>5.5</b> Apply Strategy</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-quality.html"><a href="data-quality.html"><i class="fa fa-check"></i><b>6</b> Data Quality</a><ul>
<li class="chapter" data-level="6.1" data-path="data-quality.html"><a href="data-quality.html#yahoo-vs.google"><i class="fa fa-check"></i><b>6.1</b> Yahoo! vs. Google</a></li>
<li class="chapter" data-level="6.2" data-path="data-quality.html"><a href="data-quality.html#examining-trades"><i class="fa fa-check"></i><b>6.2</b> Examining Trades</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="parameter-optimization.html"><a href="parameter-optimization.html"><i class="fa fa-check"></i><b>7</b> Parameter Optimization</a><ul>
<li class="chapter" data-level="7.1" data-path="parameter-optimization.html"><a href="parameter-optimization.html#add-distribution"><i class="fa fa-check"></i><b>7.1</b> Add Distribution</a></li>
<li class="chapter" data-level="7.2" data-path="parameter-optimization.html"><a href="parameter-optimization.html#add-distribution-constraint"><i class="fa fa-check"></i><b>7.2</b> Add Distribution Constraint</a></li>
<li class="chapter" data-level="7.3" data-path="parameter-optimization.html"><a href="parameter-optimization.html#running-parallel"><i class="fa fa-check"></i><b>7.3</b> Running Parallel</a></li>
<li class="chapter" data-level="7.4" data-path="parameter-optimization.html"><a href="parameter-optimization.html#apply-paramset"><i class="fa fa-check"></i><b>7.4</b> Apply Paramset</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="stop-loss.html"><a href="stop-loss.html"><i class="fa fa-check"></i><b>8</b> Stop-Loss Orders</a><ul>
<li class="chapter" data-level="8.1" data-path="stop-loss.html"><a href="stop-loss.html#add-indicators-1"><i class="fa fa-check"></i><b>8.1</b> Add Indicators</a></li>
<li class="chapter" data-level="8.2" data-path="stop-loss.html"><a href="stop-loss.html#add-signals-1"><i class="fa fa-check"></i><b>8.2</b> Add Signals</a></li>
<li class="chapter" data-level="8.3" data-path="stop-loss.html"><a href="stop-loss.html#add-rules-1"><i class="fa fa-check"></i><b>8.3</b> Add Rules</a></li>
<li class="chapter" data-level="8.4" data-path="stop-loss.html"><a href="stop-loss.html#add-position-limit"><i class="fa fa-check"></i><b>8.4</b> Add Position Limit</a></li>
<li class="chapter" data-level="8.5" data-path="stop-loss.html"><a href="stop-loss.html#enable-rules"><i class="fa fa-check"></i><b>8.5</b> Enable Rules</a></li>
<li class="chapter" data-level="8.6" data-path="stop-loss.html"><a href="stop-loss.html#apply-strategy-1"><i class="fa fa-check"></i><b>8.6</b> Apply Strategy</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="stop-loss-optimization.html"><a href="stop-loss-optimization.html"><i class="fa fa-check"></i><b>9</b> Stop Loss Optimization</a><ul>
<li class="chapter" data-level="9.1" data-path="stop-loss-optimization.html"><a href="stop-loss-optimization.html#add-indicators-2"><i class="fa fa-check"></i><b>9.1</b> Add Indicators</a></li>
<li class="chapter" data-level="9.2" data-path="stop-loss-optimization.html"><a href="stop-loss-optimization.html#add-signals-2"><i class="fa fa-check"></i><b>9.2</b> Add Signals</a></li>
<li class="chapter" data-level="9.3" data-path="stop-loss-optimization.html"><a href="stop-loss-optimization.html#add-rules-2"><i class="fa fa-check"></i><b>9.3</b> Add Rules</a></li>
<li class="chapter" data-level="9.4" data-path="stop-loss-optimization.html"><a href="stop-loss-optimization.html#add-position-limit-1"><i class="fa fa-check"></i><b>9.4</b> Add Position Limit</a></li>
<li class="chapter" data-level="9.5" data-path="stop-loss-optimization.html"><a href="stop-loss-optimization.html#add-distribution-1"><i class="fa fa-check"></i><b>9.5</b> Add Distribution</a></li>
<li class="chapter" data-level="9.6" data-path="stop-loss-optimization.html"><a href="stop-loss-optimization.html#add-distribution-constraint-1"><i class="fa fa-check"></i><b>9.6</b> Add Distribution Constraint</a></li>
<li class="chapter" data-level="9.7" data-path="stop-loss-optimization.html"><a href="stop-loss-optimization.html#enable-rules-1"><i class="fa fa-check"></i><b>9.7</b> Enable Rules</a></li>
<li class="chapter" data-level="9.8" data-path="stop-loss-optimization.html"><a href="stop-loss-optimization.html#apply-paramset-1"><i class="fa fa-check"></i><b>9.8</b> Apply Paramset</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="trailing-stops.html"><a href="trailing-stops.html"><i class="fa fa-check"></i><b>10</b> Trailing Stops</a><ul>
<li class="chapter" data-level="10.1" data-path="trailing-stops.html"><a href="trailing-stops.html#osfixeddollar"><i class="fa fa-check"></i><b>10.1</b> osFixedDollar</a></li>
<li class="chapter" data-level="10.2" data-path="trailing-stops.html"><a href="trailing-stops.html#add-indicators-3"><i class="fa fa-check"></i><b>10.2</b> Add Indicators</a></li>
<li class="chapter" data-level="10.3" data-path="trailing-stops.html"><a href="trailing-stops.html#add-signals-3"><i class="fa fa-check"></i><b>10.3</b> Add Signals</a></li>
<li class="chapter" data-level="10.4" data-path="trailing-stops.html"><a href="trailing-stops.html#add-rules-3"><i class="fa fa-check"></i><b>10.4</b> Add Rules</a></li>
<li class="chapter" data-level="10.5" data-path="trailing-stops.html"><a href="trailing-stops.html#enable-rules-2"><i class="fa fa-check"></i><b>10.5</b> Enable Rules</a></li>
<li class="chapter" data-level="10.6" data-path="trailing-stops.html"><a href="trailing-stops.html#save-strategy"><i class="fa fa-check"></i><b>10.6</b> Save Strategy</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="obtaining-resources.html"><a href="obtaining-resources.html"><i class="fa fa-check"></i><b>11</b> Obtaining Resources</a><ul>
<li class="chapter" data-level="11.1" data-path="obtaining-resources.html"><a href="obtaining-resources.html#amazon-web-services"><i class="fa fa-check"></i><b>11.1</b> Amazon Web Services</a></li>
<li class="chapter" data-level="11.2" data-path="obtaining-resources.html"><a href="obtaining-resources.html#getting-started"><i class="fa fa-check"></i><b>11.2</b> Getting Started</a><ul>
<li class="chapter" data-level="11.2.1" data-path="obtaining-resources.html"><a href="obtaining-resources.html#installing-quantstrat"><i class="fa fa-check"></i><b>11.2.1</b> Installing Quantstrat</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="obtaining-resources.html"><a href="obtaining-resources.html#testing-resources"><i class="fa fa-check"></i><b>11.3</b> Testing Resources</a></li>
<li class="chapter" data-level="11.4" data-path="obtaining-resources.html"><a href="obtaining-resources.html#changing-instances"><i class="fa fa-check"></i><b>11.4</b> Changing Instances</a></li>
<li class="chapter" data-level="11.5" data-path="obtaining-resources.html"><a href="obtaining-resources.html#stop-the-server"><i class="fa fa-check"></i><b>11.5</b> Stop the Server</a></li>
<li class="chapter" data-level="11.6" data-path="obtaining-resources.html"><a href="obtaining-resources.html#reading-resources"><i class="fa fa-check"></i><b>11.6</b> Reading Resources</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="analyzing-results.html"><a href="analyzing-results.html"><i class="fa fa-check"></i><b>12</b> Analyzing Results</a><ul>
<li class="chapter" data-level="12.1" data-path="analyzing-results.html"><a href="analyzing-results.html#apply-strategy-2"><i class="fa fa-check"></i><b>12.1</b> Apply Strategy</a></li>
<li class="chapter" data-level="12.2" data-path="analyzing-results.html"><a href="analyzing-results.html#chart-positions"><i class="fa fa-check"></i><b>12.2</b> Chart Positions</a></li>
<li class="chapter" data-level="12.3" data-path="analyzing-results.html"><a href="analyzing-results.html#trade-statistics"><i class="fa fa-check"></i><b>12.3</b> Trade Statistics</a><ul>
<li class="chapter" data-level="12.3.1" data-path="analyzing-results.html"><a href="analyzing-results.html#trade-related"><i class="fa fa-check"></i><b>12.3.1</b> Trade Related</a></li>
<li class="chapter" data-level="12.3.2" data-path="analyzing-results.html"><a href="analyzing-results.html#profit-related"><i class="fa fa-check"></i><b>12.3.2</b> Profit Related</a></li>
<li class="chapter" data-level="12.3.3" data-path="analyzing-results.html"><a href="analyzing-results.html#averages"><i class="fa fa-check"></i><b>12.3.3</b> Averages</a></li>
<li class="chapter" data-level="12.3.4" data-path="analyzing-results.html"><a href="analyzing-results.html#performance-summary"><i class="fa fa-check"></i><b>12.3.4</b> Performance Summary</a></li>
<li class="chapter" data-level="12.3.5" data-path="analyzing-results.html"><a href="analyzing-results.html#per-trade-statistics"><i class="fa fa-check"></i><b>12.3.5</b> Per Trade Statistics</a></li>
<li class="chapter" data-level="12.3.6" data-path="analyzing-results.html"><a href="analyzing-results.html#performance-statistics"><i class="fa fa-check"></i><b>12.3.6</b> Performance Statistics</a></li>
<li class="chapter" data-level="12.3.7" data-path="analyzing-results.html"><a href="analyzing-results.html#risk-statistics"><i class="fa fa-check"></i><b>12.3.7</b> Risk Statistics</a></li>
<li class="chapter" data-level="12.3.8" data-path="analyzing-results.html"><a href="analyzing-results.html#buy-and-hold-performance"><i class="fa fa-check"></i><b>12.3.8</b> Buy and Hold Performance</a></li>
<li class="chapter" data-level="12.3.9" data-path="analyzing-results.html"><a href="analyzing-results.html#strategy-vs.market"><i class="fa fa-check"></i><b>12.3.9</b> Strategy vs. Market</a></li>
<li class="chapter" data-level="12.3.10" data-path="analyzing-results.html"><a href="analyzing-results.html#riskreturn-scatterplot"><i class="fa fa-check"></i><b>12.3.10</b> Risk/Return Scatterplot</a></li>
<li class="chapter" data-level="12.3.11" data-path="analyzing-results.html"><a href="analyzing-results.html#relative-performance"><i class="fa fa-check"></i><b>12.3.11</b> Relative Performance</a></li>
<li class="chapter" data-level="12.3.12" data-path="analyzing-results.html"><a href="analyzing-results.html#portfolio-summary"><i class="fa fa-check"></i><b>12.3.12</b> Portfolio Summary</a></li>
<li class="chapter" data-level="12.3.13" data-path="analyzing-results.html"><a href="analyzing-results.html#order-book"><i class="fa fa-check"></i><b>12.3.13</b> Order Book</a></li>
<li class="chapter" data-level="12.3.14" data-path="analyzing-results.html"><a href="analyzing-results.html#maximum-adverse-excursion"><i class="fa fa-check"></i><b>12.3.14</b> Maximum Adverse Excursion</a></li>
<li class="chapter" data-level="12.3.15" data-path="analyzing-results.html"><a href="analyzing-results.html#maximum-favorable-excursion"><i class="fa fa-check"></i><b>12.3.15</b> Maximum Favorable Excursion</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="analyzing-results.html"><a href="analyzing-results.html#account-summary"><i class="fa fa-check"></i><b>12.4</b> Account Summary</a><ul>
<li class="chapter" data-level="12.4.1" data-path="analyzing-results.html"><a href="analyzing-results.html#equity-curve"><i class="fa fa-check"></i><b>12.4.1</b> Equity Curve</a></li>
<li class="chapter" data-level="12.4.2" data-path="analyzing-results.html"><a href="analyzing-results.html#account-performance-summary"><i class="fa fa-check"></i><b>12.4.2</b> Account Performance Summary</a></li>
<li class="chapter" data-level="12.4.3" data-path="analyzing-results.html"><a href="analyzing-results.html#cumulative-returns"><i class="fa fa-check"></i><b>12.4.3</b> Cumulative Returns</a></li>
<li class="chapter" data-level="12.4.4" data-path="analyzing-results.html"><a href="analyzing-results.html#distribution-analysis"><i class="fa fa-check"></i><b>12.4.4</b> Distribution Analysis</a></li>
<li class="chapter" data-level="12.4.5" data-path="analyzing-results.html"><a href="analyzing-results.html#annualized-returns"><i class="fa fa-check"></i><b>12.4.5</b> Annualized Returns</a></li>
<li class="chapter" data-level="12.4.6" data-path="analyzing-results.html"><a href="analyzing-results.html#performance-scatter-plot"><i class="fa fa-check"></i><b>12.4.6</b> Performance Scatter Plot</a></li>
<li class="chapter" data-level="12.4.7" data-path="analyzing-results.html"><a href="analyzing-results.html#notional-costs"><i class="fa fa-check"></i><b>12.4.7</b> Notional Costs</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="walk-forward-analysis.html"><a href="walk-forward-analysis.html"><i class="fa fa-check"></i><b>13</b> Walk Forward Analysis</a></li>
<li class="chapter" data-level="14" data-path="monte-carlo-analysis.html"><a href="monte-carlo-analysis.html"><i class="fa fa-check"></i><b>14</b> Monte Carlo Analysis</a></li>
<li class="chapter" data-level="15" data-path="warnings-and-errors.html"><a href="warnings-and-errors.html"><i class="fa fa-check"></i><b>15</b> Warnings and Errors</a><ul>
<li class="chapter" data-level="15.1" data-path="warnings-and-errors.html"><a href="warnings-and-errors.html#must-use-auto.assigntrue-for-multiple-symbols-requests"><i class="fa fa-check"></i><b>15.1</b> Must use auto.assign=TRUE for multiple Symbols requests</a></li>
<li class="chapter" data-level="15.2" data-path="warnings-and-errors.html"><a href="warnings-and-errors.html#missing-in-call-to-function-add.distribution"><i class="fa fa-check"></i><b>15.2</b> Missing in call to function add.distribution</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="about-backtesting-strategies-with-r.html"><a href="about-backtesting-strategies-with-r.html"><i class="fa fa-check"></i><b>16</b> About “Backtesting Strategies with R”</a><ul>
<li class="chapter" data-level="16.1" data-path="about-backtesting-strategies-with-r.html"><a href="about-backtesting-strategies-with-r.html#tim-trice"><i class="fa fa-check"></i><b>16.1</b> Tim Trice</a></li>
<li class="chapter" data-level="16.2" data-path="about-backtesting-strategies-with-r.html"><a href="about-backtesting-strategies-with-r.html#to-you-the-reader"><i class="fa fa-check"></i><b>16.2</b> To You, the Reader</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Backtesting Strategies with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="stop-loss" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> Stop-Loss Orders</h1>
<p>We’ll continue using a variation of the Luxor strategy. This time we’re going to implement stop-loss orders.</p>
<p>We’re also going to keep all of our settings in variables so as to make the code easier to work with from here forward.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">.fast &lt;-<span class="st"> </span><span class="dv">10</span>
.slow &lt;-<span class="st"> </span><span class="dv">30</span>
.threshold &lt;-<span class="st"> </span><span class="fl">0.0005</span>
.orderqty &lt;-<span class="st"> </span><span class="dv">100</span>
.txnfees &lt;-<span class="st"> </span>-<span class="dv">10</span>
.stoploss &lt;-<span class="st"> </span><span class="fl">3e-3</span> <span class="co"># 0.003 or 0.3%</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">portfolio.st &lt;-<span class="st"> &quot;Port.Luxor.Stop.Loss&quot;</span>
account.st &lt;-<span class="st"> &quot;Acct.Luxor.Stop.Loss&quot;</span>
strategy.st &lt;-<span class="st"> &quot;Strat.Luxor.Stop.Loss&quot;</span>

<span class="kw">rm.strat</span>(portfolio.st)
<span class="kw">rm.strat</span>(account.st)

<span class="kw">initPortf</span>(<span class="dt">name =</span> portfolio.st,
          <span class="dt">symbols =</span> symbols,
          <span class="dt">initDate =</span> init_date)</code></pre></div>
<pre><code>## [1] &quot;Port.Luxor.Stop.Loss&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">initAcct</span>(<span class="dt">name =</span> account.st,
         <span class="dt">portfolios =</span> portfolio.st,
         <span class="dt">initDate =</span> init_date,
         <span class="dt">initEq =</span> init_equity)</code></pre></div>
<pre><code>## [1] &quot;Acct.Luxor.Stop.Loss&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">initOrders</span>(<span class="dt">portfolio =</span> portfolio.st,
           <span class="dt">symbols =</span> symbols,
           <span class="dt">initDate =</span> init_date)

<span class="kw">strategy</span>(strategy.st, <span class="dt">store =</span> <span class="ot">TRUE</span>)</code></pre></div>
<div id="add-indicators-1" class="section level2">
<h2><span class="header-section-number">8.1</span> Add Indicators</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">add.indicator</span>(strategy.st, 
              <span class="dt">name =</span> <span class="st">&quot;SMA&quot;</span>,
              <span class="dt">arguments =</span> <span class="kw">list</span>(<span class="dt">x =</span> <span class="kw">quote</span>(<span class="kw">Cl</span>(mktdata)),
                               <span class="dt">n =</span> .fast),
              <span class="dt">label =</span> <span class="st">&quot;nFast&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;Strat.Luxor.Stop.Loss&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">add.indicator</span>(strategy.st, 
              <span class="dt">name =</span> <span class="st">&quot;SMA&quot;</span>,
              <span class="dt">arguments =</span> <span class="kw">list</span>(<span class="dt">x =</span> <span class="kw">quote</span>(<span class="kw">Cl</span>(mktdata)),
                               <span class="dt">n =</span> .slow),
              <span class="dt">label =</span> <span class="st">&quot;nSlow&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;Strat.Luxor.Stop.Loss&quot;</code></pre>
</div>
<div id="add-signals-1" class="section level2">
<h2><span class="header-section-number">8.2</span> Add Signals</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">add.signal</span>(strategy.st, 
           <span class="dt">name =</span> <span class="st">&quot;sigCrossover&quot;</span>,
           <span class="dt">arguments =</span> <span class="kw">list</span>(<span class="dt">columns =</span> <span class="kw">c</span>(<span class="st">&quot;nFast&quot;</span>, <span class="st">&quot;nSlow&quot;</span>),
                            <span class="dt">relationship =</span> <span class="st">&quot;gte&quot;</span>),
           <span class="dt">label =</span> <span class="st">&quot;long&quot;</span>
)</code></pre></div>
<pre><code>## [1] &quot;Strat.Luxor.Stop.Loss&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">add.signal</span>(strategy.st, 
           <span class="dt">name =</span> <span class="st">&quot;sigCrossover&quot;</span>,
           <span class="dt">arguments =</span> <span class="kw">list</span>(<span class="dt">columns =</span> <span class="kw">c</span>(<span class="st">&quot;nFast&quot;</span>, <span class="st">&quot;nSlow&quot;</span>),
                            <span class="dt">relationship =</span> <span class="st">&quot;lt&quot;</span>),
           <span class="dt">label =</span> <span class="st">&quot;short&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;Strat.Luxor.Stop.Loss&quot;</code></pre>
</div>
<div id="add-rules-1" class="section level2">
<h2><span class="header-section-number">8.3</span> Add Rules</h2>
<p>Our rules are largely the same as they were in our original Luxor strategy. However, we have added some slight modifications.</p>
<p>Let’s start off with <code>osFUN</code> which is abbreviated for order size function. It is defined as:</p>
<blockquote>
<p>function or text descriptor of function to use for order sizing.</p>
</blockquote>
<p>The default value for this parameter is <code>osNoOp</code> which is an ordering function that performs no operation. In other words, if you pass 100 as <code>orderqty</code> that is what is purchased.</p>
<p>In the <code>EnterLong</code> rule below we pass a different function, <code>osMaxPos()</code>. <code>osMaxPos()</code> works with <code>addPosLimit()</code> (next section) to set a maximum position per symbol. This will keep us from executing the same orders repeatedly.</p>
<p>We’ve also included the <code>orderset</code> parameter with a value of “ocolong”. This will help group our long and short orders together.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">add.rule</span>(strategy.st, 
         <span class="dt">name =</span> <span class="st">&quot;ruleSignal&quot;</span>,
         <span class="dt">arguments =</span> <span class="kw">list</span>(<span class="dt">sigcol =</span> <span class="st">&quot;long&quot;</span> , 
                          <span class="dt">sigval =</span> <span class="ot">TRUE</span>,
                          <span class="dt">replace =</span> <span class="ot">FALSE</span>,
                          <span class="dt">orderside =</span> <span class="st">&quot;long&quot;</span> ,
                          <span class="dt">ordertype =</span> <span class="st">&quot;stoplimit&quot;</span>,
                          <span class="dt">prefer =</span> <span class="st">&quot;High&quot;</span>,
                          <span class="dt">threshold =</span> .threshold,
                          <span class="dt">TxnFees =</span> .txnfees,
                          <span class="dt">orderqty =</span> +.orderqty,
                          <span class="dt">osFUN =</span> osMaxPos,
                          <span class="dt">orderset =</span> <span class="st">&quot;ocolong&quot;</span>),
         <span class="dt">type =</span> <span class="st">&quot;enter&quot;</span>,
         <span class="dt">label =</span> <span class="st">&quot;EnterLONG&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;Strat.Luxor.Stop.Loss&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">add.rule</span>(strategy.st, 
         <span class="dt">name =</span> <span class="st">&quot;ruleSignal&quot;</span>,
         <span class="dt">arguments =</span> <span class="kw">list</span>(<span class="dt">sigcol =</span> <span class="st">&quot;short&quot;</span>, 
                          <span class="dt">sigval =</span> <span class="ot">TRUE</span>,
                          <span class="dt">replace =</span> <span class="ot">FALSE</span>,
                          <span class="dt">orderside =</span> <span class="st">&quot;short&quot;</span>,
                          <span class="dt">ordertype =</span> <span class="st">&quot;stoplimit&quot;</span>,
                          <span class="dt">prefer =</span> <span class="st">&quot;Low&quot;</span>,
                          <span class="dt">threshold =</span> .threshold,
                          <span class="dt">TxnFees =</span> .txnfees,
                          <span class="dt">orderqty =</span> -.orderqty,
                          <span class="dt">osFUN =</span> osMaxPos,
                          <span class="dt">orderset =</span> <span class="st">&quot;ocoshort&quot;</span>),
         <span class="dt">type =</span> <span class="st">&quot;enter&quot;</span>,
         <span class="dt">label =</span> <span class="st">&quot;EnterSHORT&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;Strat.Luxor.Stop.Loss&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">add.rule</span>(strategy.st, 
         <span class="dt">name =</span> <span class="st">&quot;ruleSignal&quot;</span>,
         <span class="dt">arguments =</span> <span class="kw">list</span>(<span class="dt">sigcol =</span> <span class="st">&quot;short&quot;</span>, 
                          <span class="dt">sigval =</span> <span class="ot">TRUE</span>,
                          <span class="dt">replace =</span> <span class="ot">TRUE</span>,
                          <span class="dt">orderside =</span> <span class="st">&quot;long&quot;</span> ,
                          <span class="dt">ordertype =</span> <span class="st">&quot;market&quot;</span>,
                          <span class="dt">TxnFees =</span> .txnfees,
                          <span class="dt">orderqty =</span> <span class="st">&quot;all&quot;</span>,
                          <span class="dt">orderset =</span> <span class="st">&quot;ocolong&quot;</span>),
         <span class="dt">type =</span> <span class="st">&quot;exit&quot;</span>,
         <span class="dt">label =</span> <span class="st">&quot;Exit2SHORT&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;Strat.Luxor.Stop.Loss&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">add.rule</span>(strategy.st, 
         <span class="dt">name =</span> <span class="st">&quot;ruleSignal&quot;</span>,
         <span class="dt">arguments =</span> <span class="kw">list</span>(<span class="dt">sigcol =</span> <span class="st">&quot;long&quot;</span>, 
                          <span class="dt">sigval =</span> <span class="ot">TRUE</span>,
                          <span class="dt">replace =</span> <span class="ot">TRUE</span>,
                          <span class="dt">orderside =</span> <span class="st">&quot;short&quot;</span>,
                          <span class="dt">ordertype =</span> <span class="st">&quot;market&quot;</span>,
                          <span class="dt">TxnFees =</span> .txnfees,
                          <span class="dt">orderqty =</span> <span class="st">&quot;all&quot;</span>,
                          <span class="dt">orderset =</span> <span class="st">&quot;ocoshort&quot;</span>),
         <span class="dt">type =</span> <span class="st">&quot;exit&quot;</span>,
         <span class="dt">label =</span> <span class="st">&quot;Exit2LONG&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;Strat.Luxor.Stop.Loss&quot;</code></pre>
<p>Up to this point our <code>Luxor.Stop.Loss</code> strategy has been the same as our original <code>Luxor</code> strategy. When we take a long position we stay in it until we get a short signal, rinse and repeat.</p>
<p>However, now we’re going to put stops in place. From the onset there isn’t much different from the previous rules we have added. Many of the parameters are similar. We do have some new ones though.</p>
<p>First, we’ve created rule <strong>StopLossLONG</strong> as a child rule of the <code>parent</code> rule <strong>EnterLONG</strong>, part of the <code>orderset</code> <strong>ocolong</strong>. Currently it is not <code>enabled</code>.</p>
<p>The critical portion of <strong>StopLossLONG</strong> is the <code>tmult</code> and <code>threshold</code> parameter. When a long order is filled <code>threshold</code> and <code>tmult</code> work together to determine the stoplimit price (<code>ordertype</code>). <code>.stoploss</code> is multiplied (<code>tmult</code>) against the price of the filled long order. That price serves as the stop-loss price.</p>
<p>For example,</p>
<p><span class="math display">\[ \text{StopLossLONG} = \text{fill price } - \left( \text{.stoploss } * \text{fill price}\right) \]</span></p>
<p><span class="math display">\[ \text{StopLossLONG} = 134.39 - \left(0.003 * 134.39\right) \]</span></p>
<p><span class="math display">\[ \text{StopLossLONG} = $133.9868 \]</span></p>
<p>If market price moves below $ $133.9868 $ the <strong>StopLossLONG</strong> order becomes a market order and the <strong>Exit2SHORT</strong> order is cancelled (OCO).</p>
<p>The same applies to <strong>StopLossSHORT</strong> which is a child of <strong>EnterSHORT</strong> except <code>.stoploss</code> is added to the fill price.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">add.rule</span>(strategy.st, 
         <span class="dt">name =</span> <span class="st">&quot;ruleSignal&quot;</span>,
         <span class="dt">arguments =</span> <span class="kw">list</span>(<span class="dt">sigcol =</span> <span class="st">&quot;long&quot;</span> , 
                          <span class="dt">sigval =</span> <span class="ot">TRUE</span>,
                          <span class="dt">replace =</span> <span class="ot">FALSE</span>,
                          <span class="dt">orderside =</span> <span class="st">&quot;long&quot;</span>,
                          <span class="dt">ordertype =</span> <span class="st">&quot;stoplimit&quot;</span>,
                          <span class="dt">tmult =</span> <span class="ot">TRUE</span>,
                          <span class="dt">threshold =</span> <span class="kw">quote</span>(.stoploss),
                          <span class="dt">TxnFees =</span> .txnfees,
                          <span class="dt">orderqty =</span> <span class="st">&quot;all&quot;</span>,
                          <span class="dt">orderset =</span> <span class="st">&quot;ocolong&quot;</span>),
         <span class="dt">type =</span> <span class="st">&quot;chain&quot;</span>, 
         <span class="dt">parent =</span> <span class="st">&quot;EnterLONG&quot;</span>,
         <span class="dt">label =</span> <span class="st">&quot;StopLossLONG&quot;</span>,
         <span class="dt">enabled =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## [1] &quot;Strat.Luxor.Stop.Loss&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">add.rule</span>(strategy.st, 
         <span class="dt">name =</span> <span class="st">&quot;ruleSignal&quot;</span>,
         <span class="dt">arguments =</span> <span class="kw">list</span>(<span class="dt">sigcol =</span> <span class="st">&quot;short&quot;</span>, 
                          <span class="dt">sigval =</span> <span class="ot">TRUE</span>,
                          <span class="dt">replace =</span> <span class="ot">FALSE</span>,
                          <span class="dt">orderside =</span> <span class="st">&quot;short&quot;</span>,
                          <span class="dt">ordertype =</span> <span class="st">&quot;stoplimit&quot;</span>,
                          <span class="dt">tmult =</span> <span class="ot">TRUE</span>,
                          <span class="dt">threshold =</span> <span class="kw">quote</span>(.stoploss),
                          <span class="dt">TxnFees =</span> .txnfees,
                          <span class="dt">orderqty =</span> <span class="st">&quot;all&quot;</span>,
                          <span class="dt">orderset =</span> <span class="st">&quot;ocoshort&quot;</span>),
         <span class="dt">type =</span> <span class="st">&quot;chain&quot;</span>, 
         <span class="dt">parent =</span> <span class="st">&quot;EnterSHORT&quot;</span>,
         <span class="dt">label =</span> <span class="st">&quot;StopLossSHORT&quot;</span>,
         <span class="dt">enabled =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## [1] &quot;Strat.Luxor.Stop.Loss&quot;</code></pre>
</div>
<div id="add-position-limit" class="section level2">
<h2><span class="header-section-number">8.4</span> Add Position Limit</h2>
<p>As mentioned previously when using <code>osMaxPos()</code> we must supply a position limit to each symbol our strategy is working. We do this with <code>addPosLimit</code>. For now the only parameter we apply is <code>maxpos</code> which we set to <code>.orderqty</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">for(symbol in symbols){
    <span class="kw">addPosLimit</span>(<span class="dt">portfolio =</span> portfolio.st,
                <span class="dt">symbol =</span> symbol,
                <span class="dt">timestamp =</span> init_date,
                <span class="dt">maxpos =</span> .orderqty)
}</code></pre></div>
</div>
<div id="enable-rules" class="section level2">
<h2><span class="header-section-number">8.5</span> Enable Rules</h2>
<p>When we wrote <strong>StopLossLONG</strong> and <strong>StopLossSHORT</strong> we disabled them by assigning <code>enabled = FALSE</code>. Now we enable both rules set. This is very beneficial when you want to test a strategy versus different rulesets (rather than rewriting code).</p>
<p><code>label</code> can apply to a specific rule or by matching the value to all rules with a similar value (grep). By supply “StopLoss” to <code>label</code> we are instructing <code>quantstrat</code> to enable all of our rules with the string “StopLoss” in the <code>label</code>, <code>StopLossLONG</code> and <code>StopLossSHORT</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">enable.rule</span>(strategy.st, 
            <span class="dt">type =</span> <span class="st">&quot;chain&quot;</span>, 
            <span class="dt">label =</span> <span class="st">&quot;StopLoss&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;Strat.Luxor.Stop.Loss&quot;</code></pre>
</div>
<div id="apply-strategy-1" class="section level2">
<h2><span class="header-section-number">8.6</span> Apply Strategy</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cwd &lt;-<span class="st"> </span><span class="kw">getwd</span>()
<span class="kw">setwd</span>(<span class="st">&quot;./_data/&quot;</span>)
results_file &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;results&quot;</span>, strategy.st, <span class="st">&quot;RData&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;.&quot;</span>)
if( <span class="kw">file.exists</span>(results_file) ) {
    <span class="kw">load</span>(results_file)
} else {
    results &lt;-<span class="st"> </span><span class="kw">applyStrategy</span>(strategy.st, <span class="dt">portfolios =</span> portfolio.st)
    if(<span class="kw">checkBlotterUpdate</span>(portfolio.st, account.st, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)) {
        <span class="kw">save</span>(<span class="dt">list =</span> <span class="st">&quot;results&quot;</span>, <span class="dt">file =</span> results_file)
        <span class="kw">save.strategy</span>(strategy.st)
    }
}
<span class="kw">setwd</span>(cwd)</code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="parameter-optimization.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="stop-loss-optimization.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="assets/gitbook-2.6.7/js/app.js"></script>
<script src="assets/gitbook-2.6.7/js/lunr.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/timtrice/stock-book/edit/master/stop-loss.Rmd",
"text": "Edit This Page"
},
"download": null,
"toc": {
"collapse": "subsection"
},
"toolbar": {
"position": "static"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
